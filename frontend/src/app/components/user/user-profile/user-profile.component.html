<div class="user-profile-page">
    <div class="header">
        <button class="logout-btn" (click)="onLogout()">Logout</button>
        <div class="user-name">{{ (user$ | async)?.firstName }}</div>
    </div>

    <!-- Main Profile Container - All in One -->
    <div class="profile-container">
        <!-- Profile Header with Photo -->
        <div class="profile-header">
            <div class="profile-photo-container">
  
  <!-- ✅ If new (cropped) image exists, show it -->
  <img *ngIf="selectedImage; else CloudOrInitial"
       [src]="selectedImage"
       class="profile-photo" />

  <!-- ✅ Otherwise check cloud image or initials -->
  <ng-template #CloudOrInitial>
    <img *ngIf="(user$ | async)?.profileImage; else Initials"
         [src]="(user$ | async)?.profileImage"
         class="profile-photo" />

    <ng-template #Initials>
      <div class="profile-photo initials">
        {{ (user$ | async)?.firstName?.charAt(0) }}
        {{ (user$ | async)?.secondName?.charAt(0) }}
      </div>
    </ng-template>
  </ng-template>

</div>


            
            <div class="photo-actions">
                <label for="fileInput" class="photo-btn" style="cursor: pointer;">Upload Photo</label>
                <!-- <button class="photo-btn" id="viewPhotoBtn">View Photo</button> -->
            </div>
                <input type="file" id="fileInput" #fileInput (change)="onFileSelected($event)" accept="image/*" />
        </div>

        <!-- Profile Content -->
        <div class="profile-content">
            <h2 class="section-title">Profile Information</h2>

            <div class="info-row">
                <div class="info-label">Full Name</div>
                <div class="info-value">{{ (user$ | async)?.firstName }} {{(user$ | async)?.secondName}}</div>
            </div>

            <div class="info-row">
                <div class="info-label">Email Address</div>
                <div class="info-value">{{(user$ | async)?.email}}</div>
            </div>

            <div class="edit-profile-section">
                <button class="edit-profile-btn" (click)="showEditForm()" >Edit Profile</button>
            </div>
        </div>
    </div>

    <!-- Crop Modal -->
    <div class="modal" id="cropModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Crop Your Photo</h3>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>

            <div class="crop-container">
                <div class="crop-area">
                    <img id="cropImage" class="crop-image" src="" alt="Crop preview">
                    <div class="crop-circle"></div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-btn cancel-btn" id="cancelBtn">Cancel</button>
                <button class="photo-btn" (click)="saveCroppedImage()">Save Photo</button>
                <div *ngIf="uploadError" class="error-text">
  {{ uploadError }}
</div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div>
        <app-user-update *ngIf="howEdit"(close)="closeEditForm()"></app-user-update>
    </div>

</div>